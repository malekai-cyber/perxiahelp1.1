<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perxia Help - Copilot</title>
    <link rel="stylesheet" href="/css/variables.css">
    <link rel="stylesheet" href="/css/chatbot.css">
</head>
<body>
    <div class="chat-app" id="chatApp">
        <div class="ambient-glow"></div>
        <div class="grid-pattern"></div>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/pages/menu.html" class="brand">
                    <svg class="brand-icon" viewBox="0 0 32 32" fill="none">
                        <!-- Casco de piloto/robot -->
                        <ellipse cx="16" cy="14" rx="10" ry="9" stroke="currentColor" stroke-width="1.5" fill="none"/>
                        <!-- Visor -->
                        <path d="M8 12h16v4c0 2-3 4-8 4s-8-2-8-4v-4z" stroke="currentColor" stroke-width="1.5" fill="none"/>
                        <!-- Ojos LED -->
                        <circle cx="12" cy="14" r="2" fill="currentColor"/>
                        <circle cx="20" cy="14" r="2" fill="currentColor"/>
                        <!-- Antena -->
                        <line x1="16" y1="5" x2="16" y2="2" stroke="currentColor" stroke-width="1.5"/>
                        <circle cx="16" cy="2" r="1.5" fill="currentColor"/>
                        <!-- Base del casco -->
                        <path d="M9 20c0 0 2 3 7 3s7-3 7-3" stroke="currentColor" stroke-width="1.5" fill="none"/>
                        <!-- Auriculares -->
                        <rect x="4" y="11" width="3" height="6" rx="1" fill="currentColor" opacity="0.6"/>
                        <rect x="25" y="11" width="3" height="6" rx="1" fill="currentColor" opacity="0.6"/>
                    </svg>
                    <span>Perxia Help</span>
                </a>
                <div class="sidebar-actions">
                    <button id="newChatBtn" class="icon-btn" title="Nueva conversaci√≥n">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 5v14M5 12h14"/>
                        </svg>
                    </button>
                    <button id="collapseSidebar" class="icon-btn" title="Ocultar">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M11 17l-5-5 5-5"/>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="copilot-card">
                <div class="copilot-avatar">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <!-- Cabeza robot piloto -->
                        <circle cx="12" cy="10" r="7" stroke="currentColor" stroke-width="1.5" fill="none"/>
                        <!-- Visor -->
                        <path d="M7 9h10v3c0 1.5-2 3-5 3s-5-1.5-5-3v-3z" stroke="currentColor" stroke-width="1.5" fill="none"/>
                        <!-- Ojos -->
                        <circle cx="9.5" cy="10.5" r="1.5" fill="currentColor"/>
                        <circle cx="14.5" cy="10.5" r="1.5" fill="currentColor"/>
                        <!-- Antena -->
                        <line x1="12" y1="3" x2="12" y2="1" stroke="currentColor" stroke-width="1.5"/>
                        <circle cx="12" cy="1" r="1" fill="currentColor"/>
                        <!-- Cuello -->
                        <path d="M10 17v2h4v-2" stroke="currentColor" stroke-width="1.5"/>
                        <!-- Auriculares -->
                        <rect x="3" y="8" width="2" height="4" rx="0.5" fill="currentColor" opacity="0.7"/>
                        <rect x="19" y="8" width="2" height="4" rx="0.5" fill="currentColor" opacity="0.7"/>
                    </svg>
                </div>
                <h3>Perxia Copilot</h3>
                <p>Tu asistente de IA corporativo</p>
            </div>

            <div class="sidebar-section">
                <span class="section-label">Capacidades</span>
                <div class="capability-list">
                    <div class="capability-item">
                        <span>üìÑ</span>
                        <span>An√°lisis de documentos</span>
                    </div>
                    <div class="capability-item">
                        <span>üîç</span>
                        <span>B√∫squeda inteligente</span>
                    </div>
                    <div class="capability-item">
                        <span>üí¨</span>
                        <span>Lenguaje natural</span>
                    </div>
                    <div class="capability-item">
                        <span>üìä</span>
                        <span>Res√∫menes ejecutivos</span>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-section">
                <span class="section-label">Periferia IT Hub</span>
                <div class="capability-list legacy-capabilities">
                    <button class="capability-item clickable" data-view="casos">
                        <span>üèÜ</span>
                        <span>Casos de √©xito</span>
                        <span class="item-badge">-</span>
                    </button>
                    <button class="capability-item clickable" data-view="pocs">
                        <span>üî¨</span>
                        <span>PoCs & PoVs</span>
                        <span class="item-badge">-</span>
                    </button>
                    <button class="capability-item clickable" data-view="tools">
                        <span>üîç</span>
                        <span>Explorar Todo</span>
                        <span class="item-badge">-</span>
                    </button>
                </div>
            </div>

            <div class="sidebar-section">
                <span class="section-label">Tips</span>
                <div class="tips-list">
                    <p>üí° S√© espec√≠fico para mejores respuestas</p>
                    <p>üìé Adjunta documentos para an√°lisis</p>
                    <p>‚ö° Usa Pro para razonamiento avanzado</p>
                </div>
            </div>

            <div class="sidebar-footer">
                <input type="file" id="fileInput" hidden multiple accept=".pdf,.doc,.docx,.txt,.md,.json">
            </div>
        </aside>

        <!-- Main -->
        <main class="main-content">
            <button id="expandSidebar" class="expand-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M13 17l5-5-5-5"/>
                </svg>
            </button>

            <header class="chat-header">
                <div class="header-left">
                    <button id="backBtn" class="icon-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <div class="header-info">
                        <h1>Perxia Copilot</h1>
                        <div class="header-meta">
                            <span class="status-dot"></span>
                            <span>En l√≠nea</span>
                            <span class="sep">¬∑</span>
                            <span id="currentModelDisplay">Perxia Copilot</span>
                        </div>
                    </div>
                </div>
                <div class="header-right">
                    <button id="toggleDocsPanel" class="icon-btn" title="Mis Documentos">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <!-- Carpeta con documentos -->
                            <path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2v11z"/>
                            <line x1="9" y1="13" x2="15" y2="13"/>
                            <line x1="9" y1="17" x2="13" y2="17"/>
                        </svg>
                    </button>
                    <div class="user-avatar" id="userAvatar">U</div>
                </div>
            </header>

            <div class="chat-container" id="chatContainer">
                <!-- Panel de recursos visual (Periferia IT Hub) -->
                <div class="hub-panel" id="hubPanel" style="display: none;">
                    <div class="hub-header">
                        <button class="hub-back" id="hubBackBtn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                                <path d="M19 12H5M12 19l-7-7 7-7"/>
                            </svg>
                            <span>Volver al chat</span>
                        </button>
                        <h2 id="hubTitle">Casos de √âxito</h2>
                        <p id="hubSubtitle">Explora los proyectos exitosos de Periferia IT</p>
                    </div>
                    
                    <!-- Barra de b√∫squeda para el explorador -->
                    <div class="hub-search-container" id="hubSearchContainer" style="display: none;">
                        <div class="hub-search-wrapper">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="m21 21-4.35-4.35"/>
                            </svg>
                            <input type="text" id="hubSearchInput" placeholder="Buscar por tecnolog√≠a, cliente, proyecto..." autocomplete="off">
                        </div>
                        <p class="hub-search-hint">Ej: Azure, Power BI, banco, automatizaci√≥n...</p>
                    </div>
                    
                    <div class="hub-filters" id="hubFilters">
                        <button class="filter-chip active" data-filter="all">Todos</button>
                        <button class="filter-chip" data-filter="azure">Azure</button>
                        <button class="filter-chip" data-filter="ai">IA/ML</button>
                        <button class="filter-chip" data-filter="data">Data</button>
                    </div>
                    
                    <div class="hub-grid" id="hubGrid">
                        <!-- Los items se cargan din√°micamente desde la API -->
                    </div>
                    
                    <div class="hub-cta">
                        <p>¬øNo encuentras lo que buscas?</p>
                        <button class="hub-cta-btn" id="hubAskBtn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                            </svg>
                            Preg√∫ntame directamente
                        </button>
                    </div>
                </div>
                
                <!-- Contenedor de mensajes del chat -->
                <div class="chat-messages-wrapper" id="chatMessages">
                    <div class="welcome-screen" id="welcomeScreen">
                        <div class="welcome-icon">‚ú®</div>
                        <h2>¬øEn qu√© puedo ayudarte?</h2>
                        <p>Soy tu asistente de IA. Puedo analizar documentos, responder consultas, crear res√∫menes y ayudarte con informaci√≥n sobre casos de √©xito, PoCs y herramientas de Periferia IT.</p>
                        
                        <div class="suggestions">
                            <button class="suggestion-btn" data-prompt="Resume el documento que te voy a compartir">üìÑ Resumir documento</button>
                            <button class="suggestion-btn" data-prompt="Extrae los puntos clave">üìã Puntos clave</button>
                            <button class="suggestion-btn" data-prompt="Realiza un an√°lisis t√©cnico">üîç An√°lisis t√©cnico</button>
                            <button class="suggestion-btn" data-prompt="Compara estos documentos">üìä Comparar docs</button>
                        </div>
                        
                        <!-- Secci√≥n adicional para Legacy/Casos de √âxito -->
                        <div class="legacy-section">
                        <span class="legacy-divider">Tambi√©n puedo ayudarte con</span>
                        <div class="suggestions legacy-suggestions">
                            <button class="suggestion-btn legacy" data-prompt="¬øCu√°les son los casos de √©xito m√°s recientes de Periferia IT?">üèÜ Casos de √©xito</button>
                            <button class="suggestion-btn legacy" data-prompt="¬øQu√© PoCs y PoVs se han realizado?">üî¨ PoCs & PoVs</button>
                            <button class="suggestion-btn legacy" data-prompt="¬øQu√© herramientas internas tenemos desarrolladas?">üõ†Ô∏è Herramientas</button>
                            <button class="suggestion-btn legacy" data-prompt="¬øQu√© proyectos se han hecho con Azure AI?">‚òÅÔ∏è Proyectos Azure</button>
                        </div>
                    </div>
                    </div>
                </div>
            </div>

            <div class="input-area">
                <form id="chatForm" class="input-form">
                    <div class="input-wrapper">
                        <div class="model-selector" id="modelSelector">
                            <button type="button" class="model-btn" id="modelBtn">
                                <span id="modelBtnText">Copilot</span>
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                                    <polyline points="6 9 12 15 18 9"/>
                                </svg>
                            </button>
                            <div class="model-menu" id="modelMenu">
                                <button type="button" class="model-item active" data-model="deepseek-chat">
                                    <span class="model-name">Perxia Copilot</span>
                                    <span class="model-desc">R√°pido y eficiente</span>
                                </button>
                                <button type="button" class="model-item pro" data-model="deepseek-reasoner">
                                    <span class="model-name">Perxia Copilot Pro <span class="pro-tag">PRO</span></span>
                                    <span class="model-desc">Razonamiento avanzado</span>
                                </button>
                            </div>
                        </div>
                        
                        <textarea id="chatInput" placeholder="Escribe tu consulta..." rows="1"></textarea>
                        
                        <button type="button" id="voiceBtn" class="voice-btn" title="Grabar voz">
                            <svg class="mic-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                                <line x1="12" y1="19" x2="12" y2="23"/>
                                <line x1="8" y1="23" x2="16" y2="23"/>
                            </svg>
                            <svg class="stop-icon" viewBox="0 0 24 24" fill="currentColor" style="display:none;">
                                <rect x="6" y="6" width="12" height="12" rx="2"/>
                            </svg>
                            <div class="voice-waves" style="display:none;">
                                <span></span><span></span><span></span><span></span>
                            </div>
                        </button>
                        
                        <button type="button" id="attachBtn" class="attach-btn" title="Adjuntar">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
                            </svg>
                        </button>
                        
                        <button type="submit" id="sendBtn" class="send-btn" disabled>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="22" y1="2" x2="11" y2="13"/>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                            </svg>
                        </button>
                    </div>
                    <span class="input-hint">Enter enviar ¬∑ Shift+Enter nueva l√≠nea</span>
                </form>
            </div>
        </main>

        <!-- Docs Panel - Enhanced for RAG -->
        <aside class="docs-panel" id="docsPanel">
            <div class="docs-header">
                <h3>üìÅ Mis Documentos</h3>
                <button id="closePanelBtn" class="icon-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            
            <!-- Upload Zone -->
            <div class="docs-upload-zone" id="docsUploadZone">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
                </svg>
                <span>Arrastra archivos aqu√≠</span>
                <small>PDF, DOCX, TXT, MD (m√°x 50MB)</small>
            </div>
            
            <!-- Upload Progress -->
            <div class="docs-progress" id="docsProgress" style="display: none;">
                <div class="progress-info">
                    <span id="uploadFileName">Procesando...</span>
                    <span id="uploadStatus">Subiendo</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="uploadProgressFill"></div>
                </div>
            </div>
            
            <!-- Document List -->
            <div class="docs-content" id="docsContent">
                <div class="docs-list" id="docsList">
                    <!-- Documents will be rendered here -->
                </div>
                <div class="docs-empty" id="docsEmpty">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <!-- Carpeta vac√≠a -->
                        <path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2v11z"/>
                    </svg>
                    <p>Sin documentos</p>
                    <small>Sube documentos para que Copilot los use como contexto</small>
                </div>
            </div>
            
            <!-- RAG Toggle -->
            <div class="docs-footer">
                <label class="rag-toggle">
                    <input type="checkbox" id="ragToggle" checked>
                    <span class="toggle-slider"></span>
                    <span class="toggle-label">Usar documentos en respuestas</span>
                </label>
                <div class="docs-stats" id="docsStats">
                    <span id="docsCount">0 documentos</span>
                    <button id="purgeAllBtn" class="purge-btn" title="Eliminar todos los documentos" style="display: none;">
                        üóëÔ∏è
                    </button>
                </div>
            </div>
        </aside>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="/config.js"></script>
    <script src="https://alcdn.msauth.net/browser/2.38.1/js/msal-browser.min.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/app-chatbot.js"></script>
</body>
</html>
